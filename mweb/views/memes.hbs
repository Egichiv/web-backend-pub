{{> header}}
<div class="page-container">
  <section class="flashy-section">
    <h1 class="flashy-section__heading">Галерея мемов</h1>
    <p class="flashy-section__paragraph">
      Потому что иногда нужно просто посмеяться!
      Здесь собрана наша коллекция лучших мемов для поднятия настроения.
    </p>
  </section>

  {{#if isAuthenticated}}
    <!-- Панель администратора для загрузки мемов -->
    <section class="general-section admin-section">
      <h2 class="section-title">Добавить новый мем</h2>
      <form action="/memes/create" method="POST" class="meme-form">
        <div class="form-group">
          <label for="memeLink" class="required">Ссылка на мем:</label>
          <input type="url"
                 id="memeLink"
                 name="link"
                 required
                 placeholder="https://example.com/meme.jpg"
                 class="form-input">
          <small class="form-hint">Введите прямую ссылку на изображение мема</small>
        </div>
        <input type="hidden" name="uploader" value="{{username}}">
        <button type="submit" class="btn btn-primary">Добавить мем</button>
      </form>
    </section>
  {{/if}}

  <!-- Галерея мемов -->
  <section class="general-section">
    <h2 class="section-title">Коллекция мемов</h2>

    {{#if memes}}
      <div class="memes-gallery" id="memesGallery">
        {{#each memes}}
          <div class="meme-card">
            {{#if isFromPopular}}
              <div class="meme-badge">Популярная платформа</div>
            {{/if}}
            <div class="meme-card__image-container">
              <a href="/memes/{{id}}" target="_blank">
                <img src="{{link}}" alt="Мем от {{uploader}}" class="meme-card__image" loading="lazy">
              </a>
            </div>
            <div class="meme-card__info">
              <p class="meme-card__uploader">От: {{uploader}}</p>
              <p class="meme-card__domain">Источник: {{domain}}</p>
              <p class="meme-card__link">
                <a href="{{link}}" target="_blank" rel="noopener">{{shortLink}}</a>
              </p>
            </div>
            {{#if ../isAuthenticated}}
              <div class="meme-card__actions">
                <form method="post" action="/memes/{{id}}" style="display: inline;">
                  <input type="hidden" name="_method" value="DELETE">
                  <button type="submit" class="btn btn-small btn-danger"
                          onclick="return confirm('Удалить мем?')">
                    Удалить
                  </button>
                </form>
              </div>
            {{/if}}
          </div>
        {{/each}}
      </div>

      <!-- Пагинация -->
      {{#if hasNextPage}}
        <div class="pagination">
          {{#if hasPrevPage}}
            <a href="/memes?page={{prevPage}}" class="pagination__link">← Предыдущие</a>
          {{/if}}

          <span class="pagination__info">
            Страница {{currentPageNumber}}
          </span>

          {{#if hasNextPage}}
            <a href="/memes?page={{nextPage}}" class="pagination__link">Следующие →</a>
          {{/if}}
        </div>
      {{/if}}

      <!-- Кнопка "Загрузить еще" для ленивой загрузки (МБ УБРАТЬ) -->
      {{#if hasMore}}
        <div class="load-more-container">
          <button class="btn btn-primary btn-large" onclick="loadMoreMemes()">
            Загрузить еще мемы
          </button>
        </div>
      {{/if}}
    {{else}}
      <div class="empty-state">
        <h3>Упс! Мемов пока нет</h3>
        <p>Но скоро здесь появится много смешного контента!</p>
        {{#if isAuthenticated}}
          <p class="admin-hint">Администратор может добавить мемы выше</p>
        {{/if}}
      </div>
    {{/if}}
  </section>

  <!-- Информационная секция -->
  <section class="general-section">
    <h2 class="section-title">О разделе "Мемы"</h2>
    <div class="info-content">
      <p>
        Этот раздел создан для того, чтобы разбавить серьезные цитаты
        порцией хорошего настроения. Все мемы тщательно отобраны администрацией сайта.
      </p>
      <div class="meme-stats">
        <div class="stat-item">
          <span class="stat-text">- Всего мемов: <strong>{{memesCount}}</strong></span>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Скрипт для управления отображением мемов -->
<script>
  function toggleView(viewType) {
    const gallery = document.getElementById('memesGallery');
    if (viewType === 'grid') {
      gallery.classList.remove('memes-list');
      gallery.classList.add('memes-grid');
    } else {
      gallery.classList.remove('memes-grid');
      gallery.classList.add('memes-list');
    }
  }

  function changeSize(size) {
    const gallery = document.getElementById('memesGallery');
    gallery.classList.remove('size-small', 'size-medium', 'size-large');
    gallery.classList.add(`size-${size}`);
  }

  function loadMoreMemes() {
    // Это будет реализовано в JavaScript для динамической подгрузки
    const nextPage = {{nextPage}};
    if (nextPage) {
      window.location.href = `/memes?page=${nextPage}`;
    }
  }
</script>