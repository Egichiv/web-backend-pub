<!-- Страница поиска и просмотра цитат -->
<div class="page-container">
  <section class="general-section">
    <h1 class="page-title">Поиск цитат</h1>

    <!-- Форма поиска и фильтрации -->
    <div class="search-section">
      <form action="/quotes" method="GET" class="search-form">
        <div class="filters-container">
          <div class="form-group">
            <label for="searchText">Поиск по тексту:</label>
            <input type="text"
                   id="searchText"
                   name="search"
                   value="{{searchTerm}}"
                   placeholder="Введите текст для поиска..."
                   class="form-input">
          </div>

          <div class="form-group">
            <label for="authorFilter">Автор:</label>
            <input type="text"
                   id="authorFilter"
                   name="author"
                   value="{{selectedAuthor}}"
                   placeholder="Имя автора..."
                   class="form-input">
          </div>

          <div class="form-group">
            <label for="genreFilter">Жанр:</label>
            <select id="genreFilter" name="genre" class="form-select">
              {{#if genreOptions}}
                {{#each genreOptions}}
                  <option value="{{this.value}}"
                          {{#if (eq this.value ../selectedGenre)}}selected{{/if}}>
                    {{this.name}}
                  </option>
                {{/each}}
              {{else}}
                <option value="">Все жанры</option>
                <option value="SMART" {{#if (eq selectedGenre 'SMART')}}selected{{/if}}>Умные</option>
                <option value="MOTIVATING" {{#if (eq selectedGenre 'MOTIVATING')}}selected{{/if}}>Мотивирующие</option>
                <option value="REALISTIC" {{#if (eq selectedGenre 'REALISTIC')}}selected{{/if}}>Реалистичные</option>
                <option value="FUNNY" {{#if (eq selectedGenre 'FUNNY')}}selected{{/if}}>Смешные</option>
              {{/if}}
            </select>
          </div>
        </div>

        <div class="search-buttons">
          <button type="submit" class="btn btn-primary">Найти</button>
          <a href="/quotes" class="btn btn-secondary">Сбросить фильтры</a>
        </div>
      </form>
    </div>
  </section>

  <!-- Успешные/ошибочные сообщения -->
  {{#if successMessage}}
    <div class="alert alert-success">
      {{successMessage}}
    </div>
  {{/if}}

  {{#if errorMessage}}
    <div class="alert alert-error">
      {{errorMessage}}
    </div>
  {{/if}}

  <!-- Результаты поиска -->
  <section class="quotes-marks-section">
    <h2 class="quotes-marks-section__heading">
      Найдено цитат: {{quotesCount}}
      {{#if hasPagination}}
        (страница {{currentPageNumber}} из {{totalPages}})
      {{/if}}
    </h2>

    {{#if quotes}}
      <div class="table-container">
        <table class="quotes-table quotes-marks-section__table">
          <thead>
          <tr>
            <th>ID</th>
            <th>Автор</th>
            <th>Цитата</th>
            <th>Жанр</th>
            {{#if isAuthenticated}}
              <th>Действия</th>
            {{/if}}
          </tr>
          </thead>
          <tbody>
          {{#each quotes}}
            {{> quoteRow this isAuthenticated=../isAuthenticated}}
          {{/each}}
          </tbody>
        </table>
      </div>

      <!-- Пагинация -->
      {{#if hasPagination}}
        <div class="pagination">
          {{#if hasPrevPage}}
            <a href="/quotes?page={{prevPage}}&search={{searchTerm}}&author={{selectedAuthor}}&genre={{selectedGenre}}&sort={{selectedSort}}"
            class="pagination__link pagination__link--prev">← Предыдущая</a>
          {{/if}}

          <div class="pagination__info">
            <span class="pagination__current">Страница {{currentPageNumber}} из {{totalPages}}</span>
            <span class="pagination__total">Всего цитат: {{total}}</span>
          </div>

          {{#if hasNextPage}}
            <a href="/quotes?page={{nextPage}}&search={{searchTerm}}&author={{selectedAuthor}}&genre={{selectedGenre}}&sort={{selectedSort}}"
            class="pagination__link pagination__link--next">Следующая →</a>
          {{/if}}
        </div>
      {{/if}}

      <!-- Номера страниц (для удобства навигации) -->
      {{#if hasPagination}}
        <div class="pagination-numbers">
          {{#if (gt totalPages 1)}}
            <!-- Первая страница -->
            {{#if (gt currentPageNumber 2)}}
              <a href="/quotes?page=1&search={{searchTerm}}&author={{selectedAuthor}}&genre={{selectedGenre}}&sort={{selectedSort}}"
              class="pagination__number">1</a>
              {{#if (gt currentPageNumber 3)}}
                <span class="pagination__dots">...</span>
              {{/if}}
            {{/if}}

            <!-- Предыдущая страница -->
            {{#if hasPrevPage}}
              <a href="/quotes?page={{prevPage}}&search={{searchTerm}}&author={{selectedAuthor}}&genre={{selectedGenre}}&sort={{selectedSort}}"
              class="pagination__number">{{prevPage}}</a>
            {{/if}}

            <!-- Текущая страница -->
            <span class="pagination__number pagination__number--current">{{currentPageNumber}}</span>

            <!-- Следующая страница -->
            {{#if hasNextPage}}
              <a href="/quotes?page={{nextPage}}&search={{searchTerm}}&author={{selectedAuthor}}&genre={{selectedGenre}}&sort={{selectedSort}}"
              class="pagination__number">{{nextPage}}</a>
            {{/if}}

            <!-- Последняя страница -->
            {{#if (lt currentPageNumber (dec totalPages))}}
              {{#if (lt currentPageNumber (dec (dec totalPages)))}}
                <span class="pagination__dots">...</span>
              {{/if}}
              <a href="/quotes?page={{totalPages}}&search={{searchTerm}}&author={{selectedAuthor}}&genre={{selectedGenre}}&sort={{selectedSort}}"
              class="pagination__number">{{totalPages}}</a>
            {{/if}}
          {{/if}}
        </div>
      {{/if}}
    {{else}}
      <div class="empty-state">
        <p>По вашему запросу ничего не найдено. Попробуйте изменить параметры поиска.</p>
        <a href="/addQuote" class="btn btn-primary">Добавить первую цитату</a>
      </div>
    {{/if}}
  </section>
</div>